spring:
  application:
    name: sample-cicd-springboot-gcp

  # JPA設定
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        format_sql: true

  # SQL初期化設定
  sql:
    init:
      mode: always

  # OAuth2 / OIDC設定
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:your-google-client-id}
            client-secret: ${GOOGLE_CLIENT_SECRET:your-google-client-secret}
            scope:
              - openid
              - profile
              - email
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
        provider:
          google:
            issuer-uri: https://accounts.google.com

server:
  port: ${PORT:8080}
  # X-Forwarded-*ヘッダーを考慮してHTTPSリダイレクトURIを正しく生成
  # Cloud Runのプロキシ環境ではNATIVEを使用
  forward-headers-strategy: NATIVE

logging:
  level:
    root: INFO
    com.sn0326.cicddemo: DEBUG
    org.springframework.security: INFO

  # 構造化ロギング設定
  structured:
    format:
      console: ecs  # Elastic Common Schema形式
    ecs:
      service:
        name: ${spring.application.name}
        version: 0.0.1-SNAPSHOT
        environment: ${SPRING_PROFILES_ACTIVE:default}

# パスワードポリシー設定（NIST SP 800-63B準拠）
password:
  min-length: 8           # 最小文字数
  max-length: 64          # 最大文字数
  max-consecutive-chars: 3  # 同じ文字の最大連続数

# セキュリティ設定
security:
  account:
    lockout:
      max-attempts: 5           # 最大失敗回数
      duration-minutes: 60      # ロック期間（分）
  remember-me:
    token-validity-seconds: 1209600  # 14日間（2週間）
    cleanup-days: 30                  # 30日以上前のトークンを削除

# WebAuthn/Passkey設定
webauthn:
  rp:
    # アプリケーション識別子（ドメイン名）
    # 本番環境ではHTTPSが必須（localhostのみHTTP可）
    id: ${WEBAUTHN_RP_ID:localhost}
    # アプリケーション表示名（ブラウザの認証ダイアログに表示）
    name: ${WEBAUTHN_RP_NAME:CICD Demo Application}
  # パスキー認証を許可するオリジン（完全なURL）
  allowed-origins:
    - ${WEBAUTHN_ALLOWED_ORIGIN:http://localhost:8080}
    # 本番環境の例:
    # - https://sample-cicd-springboot-gcp.sn0326.com

# メール送信設定
mail:
  # 送信プロバイダー（mock: モック実装、sendgrid: SendGrid実装）
  provider: mock

  # デフォルト送信元メールアドレス
  from: noreply@example.com

  # SendGrid設定（将来使用）
  sendgrid:
    api-key: ${SENDGRID_API_KEY:}

  # モック設定
  mock:
    log-level: INFO        # ログレベル（INFO, DEBUG）
    simulate-delay: false  # 遅延をシミュレートするか
    delay-ms: 1000         # 遅延時間（ミリ秒）